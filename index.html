<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Dino Survival</title>
<style>
    body {
        margin: 0;
        background: #111;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        color: white;
        font-family: Arial, sans-serif;
    }
    canvas {
        background: linear-gradient(#222, #000);
        border: 2px solid #555;
    }
    #ui {
        position: absolute;
        text-align: center;
    }
    button {
        padding: 12px 25px;
        font-size: 18px;
        cursor: pointer;
    }
</style>
</head>
<body>

<div id="ui">
    <h1>DINO SURVIVAL</h1>
    <button onclick="startGame()">START</button>
    <h2 id="countdown"></h2>
</div>

<canvas id="game" width="800" height="300"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let gameRunning = false;
let gravity = 0.8;
let speed = 6;
let score = 0;

const dino = {
    x: 80,
    y: 220,
    w: 40,
    h: 50,
    vy: 0,
    jump() {
        if (this.y >= 220) this.vy = -15;
    }
};

let obstacles = [];

document.addEventListener("keydown", e => {
    if (e.code === "Space") dino.jump();
});

function startGame() {
    document.getElementById("ui").style.display = "block";
    let count = 3;
    document.getElementById("countdown").innerText = count;

    const timer = setInterval(() => {
        count--;
        if (count > 0) {
            document.getElementById("countdown").innerText = count;
        } else {
            clearInterval(timer);
            document.getElementById("ui").style.display = "none";
            resetGame();
            gameRunning = true;
        }
    }, 1000);
}

function resetGame() {
    obstacles = [];
    score = 0;
    dino.y = 220;
    dino.vy = 0;
}

function randomObstacle() {
    const type = Math.floor(Math.random() * 3);

    if (type === 0) {
        // XƯƠNG
        return { x: 800, y: 230, w: 40, h: 40, type: "bone" };
    }
    if (type === 1) {
        // DUNG NHAM
        return { x: 800, y: 240, w: 50, h: 30, type: "lava" };
    }
    // ĐẦU LÂU
    return { x: 800, y: 235, w: 35, h: 35, type: "skull" };
}

function drawDino() {
    ctx.fillStyle = "#0f0";
    ctx.fillRect(dino.x, dino.y, dino.w, dino.h);
}

function drawObstacle(o) {
    if (o.type === "bone") {
        ctx.fillStyle = "#ccc";
    } else if (o.type === "lava") {
        ctx.fillStyle = "red";
    } else {
        ctx.fillStyle = "#aaa";
    }
    ctx.fillRect(o.x, o.y, o.w, o.h);
}

function collision(a, b) {
    return a.x < b.x + b.w &&
           a.x + a.w > b.x &&
           a.y < b.y + b.h &&
           a.y + a.h > b.y;
}

function gameLoop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    if (gameRunning) {
        // Dino physics
        dino.vy += gravity;
        dino.y += dino.vy;
        if (dino.y > 220) {
            dino.y = 220;
            dino.vy = 0;
        }

        // Spawn obstacle
        if (Math.random() < 0.02) {
            obstacles.push(randomObstacle());
        }

        // Obstacles update
        for (let i = obstacles.length - 1; i >= 0; i--) {
            obstacles[i].x -= speed;
            drawObstacle(obstacles[i]);

            if (collision(dino, obstacles[i])) {
                gameRunning = false;
                document.getElementById("ui").style.display = "block";
                document.getElementById("countdown").innerText = "GAME OVER\nScore: " + score;
            }

            if (obstacles[i].x + obstacles[i].w < 0) {
                obstacles.splice(i, 1);
                score++;
            }
        }

        drawDino();

        ctx.fillStyle = "white";
        ctx.fillText("Score: " + score, 650, 30);
    }

    requestAnimationFrame(gameLoop);
}

gameLoop();
</script>

</body>
</html>
